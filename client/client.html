<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sumo Game Client Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #players { margin-top: 10px; }
        #arena { width: 600px; height: 600px; border: 1px solid #000; position: relative; margin-top: 20px; }
        .player { width: 20px; height: 20px; border-radius: 50%; position: absolute; text-align: center; line-height: 20px; color: white; }
    </style>
</head>
<body>

<h2>Sumo Game Client Test</h2>

<button id="readyBtn">Ready</button>
<button id="pushBtn">Push</button>
<button id="sprintBtn">Sprint</button>
<button id="slideBtn">Slide</button>
<button id="invulBtn">Invul</button>

<div id="countdown"></div>
<div id="players"></div>
<div id="arena"></div>

<script>
const socket = io("http://localhost:3000");

let playerId;
let roomId;

// Movement state
const movement = { vx: 0, vy: 0 };

// Listen to room join
socket.on("joined-room", (data) => {
    playerId = data.playerId;
    roomId = data.roomId;
    console.log(`Joined room ${roomId} as player ${playerId}`);
});

// Listen for room updates
socket.on("room-updated", (data) => {
    const playersDiv = document.getElementById("players");
    playersDiv.innerHTML = "Players in room: " + data.players.map(p => p.id).join(", ");
});

// Countdown messages
socket.on("countdown", (num) => {
    document.getElementById("countdown").innerText = "Game starting in: " + num;
});

socket.on("ready-timer", (num) => {
    document.getElementById("countdown").innerText = "Ready timer: " + num;
});

// Game start
socket.on("game-start", (data) => {
    console.log("Game started!", data);
});

// Ability used
socket.on("ability-used", (data) => {
    console.log(`${data.playerId} used ability ${data.ability}`);
});

// State updates (positions)
socket.on("state-update", (data) => {
    const arena = document.getElementById("arena");
    arena.innerHTML = ""; // clear

    data.players.forEach(p => {
        const el = document.createElement("div");
        el.className = "player";
        el.style.left = (p.x + 300) + "px"; // offset to center arena
        el.style.top = (p.y + 300) + "px";
        el.style.backgroundColor = p.alive ? "green" : "red";
        el.innerText = p.id.slice(0, 2);
        arena.appendChild(el);
    });
});

// Send ready
document.getElementById("readyBtn").addEventListener("click", () => {
    socket.emit("player-ready");
    console.log("Sent READY");
});

// Abilities
document.getElementById("pushBtn").addEventListener("click", () => { socket.emit("ability", "push"); });
document.getElementById("sprintBtn").addEventListener("click", () => { socket.emit("ability", "sprint"); });
document.getElementById("slideBtn").addEventListener("click", () => { socket.emit("ability", "slide"); });
document.getElementById("invulBtn").addEventListener("click", () => { socket.emit("ability", "invul"); });

// Keyboard movement
document.addEventListener("keydown", (e) => {
    switch(e.key) {
        case "ArrowUp": movement.vy = -1; break;
        case "ArrowDown": movement.vy = 1; break;
        case "ArrowLeft": movement.vx = -1; break;
        case "ArrowRight": movement.vx = 1; break;
    }
    socket.emit("input", movement);
});

document.addEventListener("keyup", (e) => {
    switch(e.key) {
        case "ArrowUp": case "ArrowDown": movement.vy = 0; break;
        case "ArrowLeft": case "ArrowRight": movement.vx = 0; break;
    }
    socket.emit("input", movement);
});
</script>
</body>
</html>
